#!/bin/bash

APP_ROOT=$(cd $(dirname $0)/..; pwd);
CLASSPATH=`cat $APP_ROOT/lib/build.properties | grep classpath | tr '=' ' ' | awk '{ print $2 }' | sed 's/\\\\//g'`
CONFIG_HOST=`cat $APP_ROOT/config/instance.properties | grep RoutableDeployableConfig_default_routesHost | tr '=' ' ' | awk '{ print $2 }'`
CONFIG_PORT=`cat $APP_ROOT/config/instance.properties | grep RoutableDeployableConfig_default_routesPort | tr '=' ' ' | awk '{ print $2 }'`
INSTANCE_KEY=`cat $APP_ROOT/config/instance.properties | grep RoutableDeployableConfig_default_instanceKey | tr '=' ' ' | awk '{ print $2 }'`

echo "Generating default config...."
cd $APP_ROOT && $JAVA_HOME/bin/java \
  -cp :${CLASSPATH} \
  com.jivesoftware.os.upena.uba.config.extractor.ConfigExtractor ${CONFIG_HOST} ${CONFIG_PORT} ${INSTANCE_KEY}
echo "Generated default config."
exit 0;